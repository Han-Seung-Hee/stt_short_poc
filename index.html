<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ìƒë‹´ ìŒì„± ìš”ì•½ PoC</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --bg: #f8fafc;
            --card: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 40px 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            letter-spacing: -0.025em;
        }

        header p {
            color: var(--text-muted);
            font-size: 1.125rem;
        }

        .main-card {
            background: var(--card);
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            padding: 32px;
            border: 1px solid var(--border);
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            transition: all 0.2s ease;
            cursor: pointer;
            margin-bottom: 24px;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background-color: #eff6ff;
        }

        .upload-area.dragging {
            border-color: var(--primary);
            background-color: #dbeafe;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 16px;
            display: block;
        }

        #file-name {
            font-weight: 500;
            color: var(--text-main);
            margin-bottom: 4px;
        }

        .upload-hint {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
        }

        button {
            flex: 1;
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 14px 24px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button:hover {
            background-color: var(--primary-hover);
        }

        button:disabled {
            background-color: var(--text-muted);
            cursor: not-allowed;
        }

        #loading {
            display: none;
            text-align: center;
            padding: 24px;
            background: #f1f5f9;
            border-radius: 8px;
            margin-bottom: 24px;
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(37, 99, 235, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .results {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
        }

        @media (min-width: 768px) {
            .results {
                grid-template-columns: 1.5fr 1fr;
            }
        }

        .result-panel {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .panel-label {
            font-weight: 700;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .content-area {
            background: #f8fafc;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 0.9375rem;
            color: var(--text-main);
            line-height: 1.7;
        }

        #summary-content {
            background: #eff6ff;
            border-color: #bfdbfe;
            color: #1e40af;
            font-weight: 500;
        }

        .meta-info {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            font-size: 0.8125rem;
            color: var(--text-muted);
        }

        .tag {
            background: #f1f5f9;
            padding: 4px 10px;
            border-radius: 100px;
            border: 1px solid var(--border);
        }

        .disclaimer {
            margin-top: 32px;
            padding: 20px;
            background-color: #f1f5f9;
            border-radius: 8px;
            font-size: 0.8125rem;
            color: #64748b;
            line-height: 1.6;
            text-align: center;
        }

        .disclaimer strong {
            color: #475569;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>ğŸ™ï¸ AI ìƒë‹´ ìš”ì•½ ì‹œìŠ¤í…œ</h1>
            <p>M1 Mac Apple Silicon ìµœì í™” STT + 3ì¤„ ìš”ì•½ PoC</p>
        </header>

        <div class="main-card">
            <div id="drop-area" class="upload-area" onclick="document.getElementById('file-input').click()">
                <span class="upload-icon">ğŸ“</span>
                <p id="file-name">í´ë¦­í•˜ê±°ë‚˜ ìŒì„± íŒŒì¼(WAV)ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</p>
                <p id="file-duration" class="upload-hint"
                    style="color: var(--primary); font-weight: 600; margin-top: 4px;"></p>
                <p class="upload-hint">ì§€ì› í¬ë§·: WAV (16kHz ê¶Œì¥)</p>
                <input type="file" id="file-input" accept=".wav" style="display:none" onchange="handleFileSelect(this)">
            </div>

            <div class="controls">
                <button id="start-btn" onclick="startProcessing()" disabled>
                    <span>âš¡ ë¶„ì„ ë° ìš”ì•½ ì‹œì‘</span>
                </button>
            </div>

            <div id="loading">
                <div class="spinner"></div>
                <span id="loading-status">AI ëª¨ë¸ êµ¬ë™ ì¤‘... (STT ë‹¨ê³„)</span>
                <span id="timer-status"
                    style="font-weight: 700; color: var(--primary); margin-left: 4px;">(00:00)</span>
            </div>

            <div class="results">
                <div class="result-panel">
                    <div class="panel-label">ğŸ’¬ ì¸ì‹ëœ í…ìŠ¤íŠ¸ ì›ë¬¸ (Transcript)</div>
                    <div id="transcript-content" class="content-area">ë¶„ì„ì„ ì‹œì‘í•˜ë©´ ì—¬ê¸°ì— í…ìŠ¤íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
                    <div
                        style="font-size: 0.75rem; color: var(--text-muted); text-align: right; margin-top: -8px; padding-right: 4px;">
                        * ì¸ì‹ëœ í…ìŠ¤íŠ¸ ì „ë¬¸ì€ ì¼ë¶€ ì˜¤íƒˆìê°€ ì¡´ì¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                </div>
                <div class="result-panel">
                    <div class="panel-label">âœ¨ í•µì‹¬ 3ì¤„ ìš”ì•½ (Summary)</div>
                    <div id="summary-content" class="content-area">ìš”ì•½ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                </div>
            </div>

            <div id="meta-info" class="meta-info" style="display:none">
                <span id="stt-info" class="tag">STT: -</span>
                <span id="llm-info" class="tag">LLM: -</span>
                <span id="time-info" class="tag">ì†Œìš”ì‹œê°„: -</span>
            </div>
        </div>

        <div class="disclaimer">
            ë³¸ ì‹œì—°ì— ì‚¬ìš©ëœ ìŒì„±/í…ìŠ¤íŠ¸ ë°ì´í„°ëŠ” <strong>AI Hub(ê³¼í•™ê¸°ìˆ ì •ë³´í†µì‹ ë¶€, NIA)</strong>ì—ì„œ ì œê³µí•˜ëŠ” ê³µê³µ ë°ì´í„°ë¥¼ í™œìš©í•˜ì˜€ìŠµë‹ˆë‹¤.<br>
            í•´ë‹¹ ë°ì´í„°ëŠ” ê¸°ìˆ  ê²€ì¦(PoC) ëª©ì ìœ¼ë¡œë§Œ í•œì‹œì ìœ¼ë¡œ ì‚¬ìš©ë˜ë©°, ì‹œì—° ì¢…ë£Œ í›„ ì¦‰ì‹œ íŒŒê¸°ë  ì˜ˆì •ì…ë‹ˆë‹¤.<br>
            ë³¸ ì‹œì—°ì˜ ë‚´ìš©ì€ ì‹¤ì œ ìƒë‹´ ì‚¬ë¡€ê°€ ì•„ë‹ˆë©°, ê°œì¸ì •ë³´ ë¹„ì‹ë³„í™” ì²˜ë¦¬ê°€ ì™„ë£Œëœ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì„ì„ ë°í™ë‹ˆë‹¤.
        </div>
    </div>

    <script>
        let selectedFile = null;
        let timerInterval = null;
        let startTime = null;

        function updateTimer() {
            if (!startTime) return;
            const now = new Date();
            const diff = Math.floor((now - startTime) / 1000);
            const minutes = String(Math.floor(diff / 60)).padStart(2, '0');
            const seconds = String(diff % 60).padStart(2, '0');
            document.getElementById('timer-status').innerText = `(${minutes}:${seconds})`;
        }

        function handleFileSelect(input) {
            if (input.files && input.files[0]) {
                selectedFile = input.files[0];
                document.getElementById('file-name').innerText = selectedFile.name;

                // ìŒì„± íŒŒì¼ ê¸¸ì´ ì¶”ì¶œ ë¡œì§
                const audio = new Audio(URL.createObjectURL(selectedFile));
                audio.onloadedmetadata = function () {
                    const duration = audio.duration;
                    const minutes = Math.floor(duration / 60);
                    const seconds = Math.floor(duration % 60);
                    document.getElementById('file-duration').innerText = `ì´ ìŒì„± ê¸¸ì´: ${minutes}ë¶„ ${seconds}ì´ˆ`;
                    // ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
                    URL.revokeObjectURL(audio.src);
                };

                document.getElementById('start-btn').disabled = false;
            }
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë°©ì§€
        const dropArea = document.getElementById('drop-area');
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => dropArea.classList.add('dragging'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => dropArea.classList.remove('dragging'), false);
        });

        dropArea.addEventListener('drop', e => {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0 && files[0].name.toLowerCase().endsWith('.wav')) {
                document.getElementById('file-input').files = files;
                handleFileSelect(document.getElementById('file-input'));
            } else {
                alert('WAV íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            }
        });

        async function startProcessing() {
            if (!selectedFile) return;

            const startBtn = document.getElementById('start-btn');
            const loading = document.getElementById('loading');
            const transcriptArea = document.getElementById('transcript-content');
            const summaryArea = document.getElementById('summary-content');
            const metaArea = document.getElementById('meta-info');
            const loadingStatus = document.getElementById('loading-status');

            startBtn.disabled = true;
            loading.style.display = 'block';
            metaArea.style.display = 'none';
            transcriptArea.innerText = 'ì¸ì‹ ì¤‘...';
            summaryArea.innerText = 'ëŒ€ê¸° ì¤‘...';
            loadingStatus.innerText = 'Apple Silicon Metal ê°€ì†ìœ¼ë¡œ STT ë¶„ì„ ì¤‘...';
            document.getElementById('timer-status').innerText = '(00:00)';

            // íƒ€ì´ë¨¸ ì‹œì‘
            startTime = new Date();
            timerInterval = setInterval(updateTimer, 1000);

            const formData = new FormData();
            formData.append('file', selectedFile);

            try {
                const response = await fetch('http://localhost:8080/api/v1/process', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜ (ëª¨ë¸ ë¡œë“œ ìƒíƒœ í™•ì¸ í•„ìš”)');

                const data = await response.json();

                transcriptArea.innerText = data.transcript || '(ì¸ì‹ ê²°ê³¼ ì—†ìŒ)';
                summaryArea.innerText = data.summary || '(ìš”ì•½ ì‹¤íŒ¨)';

                // ë©”íƒ€ ì •ë³´ í‘œì‹œ
                document.getElementById('stt-info').innerText = `STT: ${data.model_info.stt}`;
                document.getElementById('llm-info').innerText = `LLM: ${data.model_info.llm}`;
                document.getElementById('time-info').innerText = `ì´ ì†Œìš”ì‹œê°„: ${data.processing_time.total_sec}ì´ˆ`;
                metaArea.style.display = 'flex';

            } catch (error) {
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
                transcriptArea.innerText = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                summaryArea.innerText = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            } finally {
                if (timerInterval) clearInterval(timerInterval);
                startBtn.disabled = false;
                loading.style.display = 'none';
            }
        }
    </script>
</body>

</html>